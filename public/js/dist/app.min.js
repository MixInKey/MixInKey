!function(e){$(document).ready(function(){document.getElementById("slider-range");$(this).tooltip(),$(".collapsible").collapsible({accordion:!1}),$(".button-collapse").sideNav(),$(".title-search-collapse").click(function(){$(".search-collapse").slideToggle("slow")})}),e.config(["$routeProvider","$locationProvider",function(e,n){e.when("/",{templateUrl:"Search/index.html",controller:"PlayerController",controllerAs:"player"}),n.html5Mode(!0)}]),angular.module("templates",[])}(angular.module("beatportApp",["beatportService","ngRoute","templates"],["$interpolateProvider",function(e){e.startSymbol("[%"),e.endSymbol("%]")}])),function(e){e.controller("MainController",["$sce","$timeout","$location","$rootScope","Beatport",function(e,n,t,a,r){var l=this;l.tracks={},l.artists={},l.genres={},l.bpm=0,l.tracks.results,l.query={},l.filtered,l.pages=[],l.nbPages,l.perPage=30,l.currentPage=0,l.lastPage=0,l.isLoadingItems=!1,l.NoResultsException=!1,l.findGenres=function(){r.getAllGenres().success(function(e){l.genres=e.results,l.lastPage=0}).error(function(e){console.log(e)})},l.search=function(){angular.element(".search-collapse").hide("slow"),l.query.page=l.lastPage=0,r.findTracks(l.query).success(function(e){return e.results.length<1||!e.metadata?(l.NoResultsException=!0,n(function(){angular.element(".search-collapse").show("slow"),l.NoResultsException=!1},1e3),l.tracks={},l.currentPage=0):(l.currentPage=0,void(l.tracks=e))}).error(function(e){console.log(e)})},l.extend=function(e,n){if(count=0,l.lastPage<1)return n;for(var t in e)++count;console.log("number of element: "+count);for(var t in n)e[count]=n[t],++count;return e},l.keys=[{key:"",value:""},{key:8,value:"A Minor"},{key:23,value:"A Major"},{key:26,value:"A# Minor"},{key:25,value:"A# Major"},{key:10,value:"B Minor"},{key:13,value:"B Major"},{key:5,value:"C Minor"},{key:20,value:"C Major"},{key:28,value:"C# Minor"},{key:27,value:"C# Major"},{key:7,value:"D Minor"},{key:22,value:"D Major"},{key:30,value:"D# Minor"},{key:29,value:"D# Major"},{key:9,value:"E Minor"},{key:24,value:"E Major"},{key:4,value:"F Minor"},{key:19,value:"F Major"},{key:11,value:"F# Minor"},{key:14,value:"F# Major"},{key:6,value:"G Minor"},{key:21,value:"G Major"},{key:32,value:"G# Minor"},{key:31,value:"G# Major"}],l.getMoreTracks=function(){l.pages.length<4||(l.isLoadingItems=!0,l.lastPage+=150,l.query.page=l.lastPage,console.log("Loading tracks ..."),r.findTracks(l.query).success(function(e){var n={metadata:e.metadata};n.results=[],n.results=l.extend(l.tracks.results,e.results),l.tracks=n,l.isLoadingItems=!1}).error(function(e){console.log(e)}))},l["switch"]=function(e){return l.nbPages<=e+1&&l.getMoreTracks(),l.currentPage=e-1},l.changePlayerTrack=function(e){var n=angular.element("#player").controller();n.changeTrack(e)},l.moreBpm=function(){l.BPM+=l.BPM<100?10:0,l.BPM=l.BPM<=100?l.BPM:100,document.getElementById("bpm-input").MaterialSlider.change(l.BPM)},l.lessBpm=function(){l.BPM-=l.BPM>0?10:0,l.BPM=l.BPM>=0?l.BPM:0,document.getElementById("bpm-input").MaterialSlider.change(l.BPM)},$("#bpm-input").change(function(){l.BPM=parseInt($(this).val())}),l.isActive=function(e){return l.currentPage==e-1},l.getNbPages=function(e,n){return Math.ceil(e/n)},a.$watch(function(){return l.filtered},function(e,n){r=0,angular.forEach(e,function(e){r++});var t=l.getNbPages(r,l.perPage);l.nbPages=t;for(var a=[],r=1;t>=r;r++)a.push(r);l.pages=a},!0)}])}(angular.module("beatportApp")),function(e){e.controller("PlayerController",["Beatport","$sce","$rootScope","$timeout",function(e,n,t,a){var r=this;r.isPlay=!1,r.currentTrack={id:"2003405",audioUrl:n.trustAsResourceUrl("https://geo-samples.beatport.com/lofi/2003405.LOFI.mp3"),name:"Mary Jane",cover:"http://geo-media.beatport.com/image/2990439.jpg"},r.changeTrack=function(e){r.currentTrack.audioUrl=n.trustAsResourceUrl("https://geo-samples.beatport.com/lofi/"+e.id+".LOFI.mp3"),r.currentTrack.id=e.id,r.currentTrack.name=e.name,r.currentTrack.cover=e.images.medium.url,a(function(){audio.play(),r.isPlay=r.isPlaying()},500),console.log("Change track - use #"+trackId)},r.startStop=function(){r.isPlaying()?audio.pause():audio.play(),r.isPlay=r.isPlaying()},r.play=function(){var e=angular.element("#player .pause");e.hasClass("fa-play")&&e.trigger("click")},r.isPlaying=function(){return!audio.paused},r.getResourceUrl=function(e){return n.getResourceUrl(e)}}])}(angular.module("beatportApp")),function(e){function n(){return{restrict:"EA",replace:!0,templateUrl:"Search/results.html"}}function t(){return{restrict:"EA",replace:!0,templateUrl:"Search/form.html"}}function a(){return{restrict:"EA",replace:!0,templateUrl:"Search/player.html",controller:"SearchController",controlllerAs:"search"}}e.directive("resultsBlock",n),e.directive("searchForm",t),e.directive("player",a)}(angular.module("beatportApp")),function(e){function n(){return function(e,n){return e?(n=+n,e.slice(n)):void 0}}function t(){return function(e){return e?(e.search(e)>-1&&(e=e.replace("&#9839;","#")),e):void 0}}function a(){return function(e){if(e){var n="";return e.length>0?(e.forEach(function(e){n.length>0?n+=", "+e.name:n=e.name}),n):void 0}}}e.filter("startFrom",n),e.filter("serializeKey",t),e.filter("implodeArtists",a)}(angular.module("beatportApp")),angular.module("beatportService",[]).factory("Beatport",["$http",function(e){var n=window.location.origin;return{getOne:function(t){return e.get(n+"/track/"+t)},getByArtist:function(t){return e.get(n+"/artist/"+t)},getAllGenres:function(){return e.get(n+"/genres")},findTracks:function(t){return console.log(t),e.post(n+"/search/tracks",t)}}}]),angular.module("templates").run(["$templateCache",function(e){e.put("Search/form.html",'<div class="container search-collapse">\n\n  <div class="form-group">\n    <div class="input-field col s12">\n      <input id="artistName" type="text" class="validate" ng-model="main.query.artistName">\n      <label for="artistName">Artist</label>\n    </div>\n  </div>\n\n  <div class="search-select">\n    <div class="form-group form-group-label genre" ng-init="main.findGenres()">\n      <label for="genre">Genres</label>\n      <select class="form-control" id="genre" ng-model="main.query.genre">\n        <option value="[% genre.id %]" ng-repeat="genre in main.genres">[% genre.name %]</option>\n      </select>\n    </div>\n    <div class="form-group form-group-label key">\n      <label for="key">Key</label>\n      <select class="form-control" id="key" ng-model="main.query.key">\n        <<option value="[% key.key %]" ng-repeat="key in main.keys">[% key.value %]</option>\n      </select>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <label for="bpm">BPM</label>\n    <p class="range-field">\n      <input type="range" title="[% main.query.bpm %]" name="range" min="0" max="175" id="bpm" ng-model="main.query.bpm" />\n    </p>\n  </div><br>\n\n  <div class="button-search bot-space">\n    <a ng-click="main.search()" class="waves-effect waves-light btn btn-search-collapse"><i class="material-icons left">search</i>Search</a>\n  </div>\n</div>\n'),e.put("Search/index.html",'<div class="search z-depth-1">\n	<a class="title-search-collapse">\n		<div class="page-header">\n			<h3>Search <i class="material-icons">keyboard_arrow_down</i></h3>\n		</div><br>\n	</a>\n	<search-form></search-form> <!-- Search form -->\n</div>\n<div class="search z-depth-1" ng-if="main.NoResultsException">\n	<div class="container">\n	    <h5>No results found</h5>\n	</div>\n</div>\n<results-block></results-block> <!-- Results of search -->\n'),e.put("Search/results.html",'<div class="result z-depth-1" ng-if="main.tracks.results" >\n  <div class="container">\n    <div class="row">\n        <table class="bordered">\n         <thead>\n           <tr>\n               <th data-field="cover">Cover</th>\n               <th data-field="artist">Artist</th>\n               <th data-field="track">Track</th>\n               <th data-field="genre">Genre</th>\n               <th data-field="key">Key</th>\n               <th data-field="bpm">BPM</th>\n               <th data-field="play">Play</th>\n           </tr>\n         </thead>\n         <tbody ng-repeat="track in main.filtered = (main.tracks.results | filter: query ) | startFrom:main.currentPage*main.perPage | limitTo:main.perPage">\n           <tr>\n             <td>\n               <img class="thumbnail" ng-src="[% track.images.medium.url %]">\n             </td>\n             <td>[% track.artists | implodeArtists %]</td>\n             <td>[% track.name %]</td>\n             <td>[% track.genres[0].name %]</td>\n             <td>[% track.key.shortName | serializeKey %]</td>\n             <td>[% track.bpm %]</td>\n             <td>\n               <a id="[% track.id %]" ng-click="main.changePlayerTrack(track)"><i class="material-icons">play_circle_filled</i></a>\n             </td>\n           </tr>\n         </tbody>\n       </table>\n    </div>\n    <div class="text-center">\n      <ul class="pagination">\n        <li class="waves-effect"\n          ng-class="main.isActive(i) ? \'active\' : \'\'"\n          ng-click="main.switch(i)"\n          ng-repeat="i in main.pages">\n          <a>[% i %]</a>\n        </li>\n        <li ng-if="main.isLoadingItems">\n          <i id="page-spinner" class="fa fa-spinner fa-spin"></i>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n')}]);
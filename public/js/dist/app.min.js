!function(e){$(document).ready(function(){document.getElementById("slider-range");$(this).tooltip(),$(".collapsible").collapsible({accordion:!1}),$(".button-collapse").sideNav(),$(".title-search-collapse").click(function(){$(".search-collapse").slideToggle("slow")}),$("#search").on("focus",function(){$(this).toggleClass("field-border")}).on("blur",function(){$(this).toggleClass("field-border")})}),e.config(["$routeProvider","$locationProvider",function(e,t){e.when("/search",{templateUrl:"Search/index.html"}).when("/results/:page",{templateUrl:"Search/index.html",controller:"PlayerController",controllerAs:"player"}).otherwise("/search"),t.html5Mode(!0)}]),angular.module("templates",[])}(angular.module("beatportApp",["beatportService","ngRoute","templates"],["$interpolateProvider",function(e){e.startSymbol("[%"),e.endSymbol("%]")}])),function(e){e.controller("MainController",["$sce","$timeout","$location","$rootScope","$routeParams","Beatport",function(e,t,r,a,n,i){var o=this,l=angular.element("#player");o.tracks={},o.artists={},o.genres={},o.bpm=0,o.tracks.results,o.query={},o.filtered,o.pages=[],o.nbPages,o.perPage=30,o.currentPage=0,o.lastPage=0,o.isLoadingItems=!1,o.NoResultsException=!1,o.keys=[{key:"",value:""},{key:8,value:"A Minor"},{key:23,value:"A Major"},{key:26,value:"A# Minor"},{key:25,value:"A# Major"},{key:10,value:"B Minor"},{key:13,value:"B Major"},{key:5,value:"C Minor"},{key:20,value:"C Major"},{key:28,value:"C# Minor"},{key:27,value:"C# Major"},{key:7,value:"D Minor"},{key:22,value:"D Major"},{key:30,value:"D# Minor"},{key:29,value:"D# Major"},{key:9,value:"E Minor"},{key:24,value:"E Major"},{key:4,value:"F Minor"},{key:19,value:"F Major"},{key:11,value:"F# Minor"},{key:14,value:"F# Major"},{key:6,value:"G Minor"},{key:21,value:"G Major"},{key:32,value:"G# Minor"},{key:31,value:"G# Major"}],o.findGenres=function(){i.getAllGenres().success(function(e){o.genres=e.results,o.lastPage=0}).error(function(e){console.log(e)})},o.search=function(){var e=o.query.artistName;e&&(o.query.artistName=o.eachFirstToUpper(e)),angular.element(".search-collapse").hide("slow"),o.query.page=o.lastPage=0,i.findTracks(o.query).success(function(e){return e.results.length<1||!e.metadata?(o.NoResultsException=!0,t(function(){angular.element(".search-collapse").show("slow"),o.NoResultsException=!1},1e3),o.tracks={},o.currentPage=0):(o.currentPage=0,r.path("/results/1"),void(o.tracks=e))}).error(function(e){console.log(e)})},o.extend=function(e,t){if(count=0,o.lastPage<1)return t;for(var r in e)++count;console.log("number of element: "+count);for(var r in t)e[count]=t[r],++count;return e},o.getMoreTracks=function(){o.pages.length<4||(o.isLoadingItems=!0,o.lastPage+=150,o.query.page=o.lastPage,console.log("Loading tracks ..."),i.findTracks(o.query).success(function(e){var t={metadata:e.metadata};t.results=[],t.results=o.extend(o.tracks.results,e.results),o.tracks=t,o.isLoadingItems=!1}).error(function(e){console.log(e)}))},o["switch"]=function(e){return o.nbPages<=e+1&&o.getMoreTracks(),r.path("results/"+e),o.currentPage=e-1},o.changePlayerTrack=function(e){var t=l.controller();return e.id==t.currentTrack.id?(audio.paused?audio.play():audio.pause(),t.isPlay=audio.paused?!1:!0):void t.changeTrack(e)},o.isCurrentTrack=function(e){return audio.paused?!1:l.controller().currentTrack.id==e},o.isActive=function(e){return o.currentPage==e-1},o.getNbPages=function(e,t){return Math.ceil(e/t)},o.eachFirstToUpper=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},a.$watch(function(){return o.filtered},function(e,t){n=0,angular.forEach(e,function(e){n++});var r=o.getNbPages(n,o.perPage);o.nbPages=r;for(var a=[],n=1;r>=n;n++)a.push(n);o.pages=a},!0),$(".search input, .search select").on("keydown",function(e){13==e.keyCode&&o.search()})}])}(angular.module("beatportApp")),function(e){e.controller("PlayerController",["Beatport","$sce","$rootScope","$routeParams","$timeout",function(e,t,r,a,n){var i=this;i.isPlay=!1,i.currentTrack={id:"2003405",audioUrl:t.trustAsResourceUrl("https://geo-samples.beatport.com/lofi/2003405.LOFI.mp3"),name:"Mary Jane",cover:"http://geo-media.beatport.com/image/2990439.jpg"},i.forward=function(){console.log(a)},i.changeTrack=function(e){i.currentTrack.audioUrl=t.trustAsResourceUrl("https://geo-samples.beatport.com/lofi/"+e.id+".LOFI.mp3"),i.currentTrack.id=e.id,i.currentTrack.name=e.name,i.currentTrack.cover=e.images.medium.url,n(function(){audio.play(),i.isPlay=i.isPlaying()},500)},i.startStop=function(){i.isPlaying()?audio.pause():audio.play(),i.isPlay=i.isPlaying()},i.play=function(){var e=angular.element("#player .pause");e.hasClass("fa-play")&&e.trigger("click")},i.isPlaying=function(){return!audio.paused},i.getResourceUrl=function(e){return t.getResourceUrl(e)}}])}(angular.module("beatportApp")),function(e){function t(){return function(e,t){return e?(t=+t,e.slice(t)):void 0}}function r(){return function(e){return e?(e.search(e)>-1&&(e=e.replace("&#9839;","#")),e):void 0}}function a(){return function(e){if(e){var t="";return e.length>0?(e.forEach(function(e){t+=t.length>0?", "+e.name:e.name}),t):void 0}}}function n(){return function(e){return 0!=e?e:void 0}}e.filter("startFrom",t),e.filter("serializeKey",r),e.filter("listArtists",a),e.filter("emptyBpm",n)}(angular.module("beatportApp")),angular.module("beatportService",[]).factory("Beatport",["$http",function(e){var t=window.location.origin;return{getOne:function(r){return e.get(t+"/track/"+r)},getByArtist:function(r){return e.get(t+"/artist/"+r)},getAllGenres:function(){return e.get(t+"/genres")},findTracks:function(r){return console.log(r),e.post(t+"/search/tracks",r)}}}]),angular.module("templates").run(["$templateCache",function(e){e.put("Search/index.html",'<span ng-init="main.forward()"></span>\n<div class="search z-depth-1" ng-if="main.NoResultsException">\n	<div class="container">\n	    <h5>No results found</h5>\n	</div>\n</div>\n<div class="result z-depth-1" ng-if="main.tracks.results" >\n  <div class="container">\n    <div class="row">\n        <table class="bordered table-hover">\n         <thead>\n           <tr>\n               <th data-field="cover">Cover</th>\n               <th data-field="artist">Artist</th>\n               <th data-field="track">Track</th>\n               <th data-field="genre">Genre</th>\n               <th data-field="key">Key</th>\n               <th data-field="bpm">BPM</th>\n               <th data-field="play">Play</th>\n           </tr>\n         </thead>\n         <tbody ng-repeat="track in main.filtered = (main.tracks.results | filter: query ) | startFrom:main.currentPage*main.perPage | limitTo:main.perPage | orderBy:\'-id\' track by $index">\n           <tr ng-class="main.isCurrentTrack(track.id) ? \'selected-track\' : \'\'">\n             <td>\n               <img class="thumbnail track-cover" ng-src="[% track.images.large.url %]">\n             </td>\n             <td>[% track.artists | listArtists %]</td>\n             <td>[% track.name %] ([% track.mixName %])</td>\n             <td>[% track.genres[0].name %]</td>\n             <td>[% track.key.shortName | serializeKey %]</td>\n             <td>[% track.bpm | emptyBpm %]</td>\n             <td>\n               <a id="[% track.id %]" ng-click="main.changePlayerTrack(track)">\n                 <i class="ctrl-result" ng-class="main.isCurrentTrack(track.id) ? \'fa fa-pause-circle\' : \'fa fa-play-circle\'"></i></a>\n             </td>\n           </tr>\n         </tbody>\n       </table>\n    </div>\n    <div class="text-center">\n      <ul class="pagination">\n        <li class="waves-effect"\n          ng-class="main.isActive(i) ? \'active\' : \'\'"\n          ng-click="main.switch(i)"\n          ng-repeat="i in main.pages">\n          <a>[% i %]</a>\n        </li>\n        <li ng-if="main.isLoadingItems">\n          <i id="page-spinner" class="fa fa-spinner fa-spin"></i>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n')}]);